% !TEX root = scombinatorics.tex
\documentclass[scombinatorics.tex]{subfiles}
\begin{document}
\chapter{Small transversals}
\label{fractional}

\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{23ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}
Unlike the rest of these notes, this chapter is not self contained, as it relies on the duality of linear programming.
The reader can use the result as a black box.
Otherwise, we recommend~\cite{LPmatousek}*{Chapter 6}, a lively and conceptual introduction to linear programming (a rarity for an otherwise rather dry subject).

%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
\section{Transversals and packings}\label{Transversals_Packings}

Let $\phi(x\,;z)$ be given. 
Let $A\subseteq\U$ and $B\subseteq\V$ be finite sets. 
%(It seems that most of the section smoothly generalizes to rational valued formulas and multisets, see below.)

A subset $A'\subseteq A$ is a \emph{transversal\/} if $\phi(A',b)\neq\0$ for every $b\in B$. Equivalently, if the sets $\phi(a,B)_{a\in A'}$ cover $B$, i.e.

\ceq{\hfill\V}
{=}
{\bigcup_{a\in A'}\phi(a,B).}

The \emph{transversal number\/} is the smallest cardinality of a transversal $A'$.
It denoted by \emph{$\tau$.} 

A subset $B'\subseteq B$ is a \emph{packing\/} if $\phi(A,b)\cap\phi(A,b')=\0$ for every $b,b'\in B'$. Equivalently if $|\phi(a,B')|\le1$ for every $a\in A$.
The \emph{packing number\/} is the largest cardinality of a packing $B'$.
It is denoted by \emph{$\nu$.}

We may write \emph{$\tau_{\phi(A,B)}$} and  \emph{$\nu_{\phi(A,B)}$} when ambiguity is of concern. 

If $A'$ is a transversal and $B'\subseteq B$, then the sets $\phi(a,B')_{a\in A'}$ cover $B'$.
Now, suppose $B'$ is a packing, then these sets contain at most one element, hence $|B'|\le|A'|$.
Therefore, we always have $\nu\le\tau$.
Very little can be said in general about the reverse direction.

\begin{example}\label{expl_tr_pk}
  Let $\U=\RR^2$ and $\V$ is the set of lines in $\RR^2$.
  Let $\phi(x\,;z)$ be the incidence (that is, membership) relation.
  Let $A\subseteq\U$ and let $B\subseteq\V$ be a set of $n$ lines in generic position
  (any to lines intersect and every point is contained in at most two lines).
  Then $\tau=\lceil n/2\rceil$, as each point belongs to at most two lines, while $\nu=1$, as any two lines intersect.\QED
\end{example}  


A (fractional) multiset over $\U$ is a nonnegative real-valued function $A':\U\to\RR_{\ge0}$.
We interpret $A'(a)$ as the multiplicity of the element $a$ in the multiset $A'$.

We write \emph{$\phi(A',b)$\/} for the multiset $A'\cdot\Indicator_{\phi(\U,b)}$.

The \emph{support\/} of a multiset is the set where it is positive.
For multisets of finite support we define the \emph{size\/} to be\smallskip 

\ceq{\hfill\emph{$|A'|$}}
{=}
{\sum_{a\in\U}A'(a)}

A multiset over $\V$ and $\phi(a,B')$ are defined analogously.
 
If $A'$ and $A''$ are multisets we write $A'\le A''$ if $A'(a)\le A''(a)$ holds for every $a$.

A \emph{fractional transversal\/} is a multiset $A'\le\Indicator_A$ such that $|\phi(A', b)|\ge1$ for every $b\in B$.
The \emph{fractional transversal number\/} of $\phi(x\,;z)$, denoted by $\tau^*$, is the  infimum of the size of the fractional transversals of $\phi(x\,;z)$.

A fractional multiset $B'\le\Indicator_B$ over $\V$ is a \emph{fractional packing\/} if $|\phi(a,B')|\le1$ for every $a\in A$.
The \emph{fractional packing number\/} of $\phi(x\,;z)$, denoted by $\nu^*$, is the supremum of the size of the fractional packings of $\phi(x\,;z)$.

The notation $\tau^*$ and $\nu^*$ is standard. 
It is not related with the dual/opposite of a formula, $\phi(x\,;z)^*$. 

\begin{example}
  The sets $\U,\V$ and the relation $\phi(A\,;B)$ are as in the example~\ref{expl_tr_pk}.
  Let $B'$ be a multiset that assigns $1/2$ to every line in $B$. Then $|\phi(a,B')|\le1$ holds because each point is contained in at most two lines.
  Then $\nu^*\ge |B'|=n/2$.
  It is easy to see that $\tau^*\ge n/2$.
  We claim that $\tau\le n/2$.
  If $n$ is even, use the same transversal $A'$ as in Example~\ref{expl_tr_pk} is even.
  If $n$ is odd, take $3$ any lines, and assign $1/2$ to the three intersection points.
  Proceed as in the even case with the other lines.\QED
\end{example}

\begin{exercise}
Let $\U=\RR$ and $\V$ is a set of finitely many closed intervals.
Let $\phi(x\,;z)$ be the membership relation.
Then $\nu=\tau$.
Hint: use induction on $\nu$.\QED
\end{exercise}

\begin{theorem}\label{thm_fractional_nu=tau}
 For all $\phi(x\,;z)$ and all finite sets $A\subseteq\U$ and $B\subseteq\V$, we have $\nu^*=\tau^*$ and this value is rational.
\end{theorem}
\begin{proof}
Let $A=\{a_1,\dots,a_m\}$ and $B=\{b_1,\dots,b_n\}$.
Let $F$ be the $\{0,1\}$-valued incidence matrix $\phi(a_i,b_j)$.
A multi-set over $\U$ is a naturally associated to a vector $0\le x\in\RR^m$.
A multi-set over $\U$ is associated to a vector $0\le y\in\RR^n$.
Then it is easy to verify that

\ceq{\hfill\tau^*}{=}{\min\,\big\{\,1_n^{\rm T}\;x\ :\ \ F\,x\ge 1_m,\ 0\le x\};}

\ceq{\hfill\nu^*}{=}{\max\big\{\,1_n^{\rm T}\ y\,\  :\ F^{\rm T}y\le 1_n,\,\  0\le y\}.}

Therefore, by he duality of linear programming $\nu^*=\tau^*$.

As $\tau^*$ is the minimum of the linear function $x\mapsto 1_n^{\rm T}\;x$ over a polyhedron, such minimum is attained at vertex.
The inequalities describing the polyhedron have rational coefficients, so also the vertices have rational coordinates (elaborate on this).
\end{proof}

When $\phi(x\,;z)$ has finite \vc-dimension, the transversal number $\tau$ is bounded by a function of $\tau^*$. 

\begin{proposition}\label{prop_bound_fractional_trans}
  Let $\phi(x\,;z)$ have \vc-dimension $k$.
  Then for all finite sets $A\subseteq\U$ and $B\subseteq\V$
  
  \ceq{\hfill\tau}{\le}{ c\,k\,(\tau^*)^2\,\ln (k\,\tau^*)}
  
  where $c$ is an absolute constant.
\end{proposition}
  
\begin{proof}
  Let $A'$ be an optimal fractional transversal.
  After normalizing, $A'$ defines a probability measure $\Pr$ on $\U$.
  Namely, $\Pr(\{a\})=A(a)/\tau^*$ for $a\in\U$.
  By the definition of fractional transversal, every set $\phi(A\,;b)_{b\in B}$ has measure at last $1/\tau^*$.
  By Proposition~\ref{prop_vc_sample}, for every $\epsilon>0$ there is a sample $s$ of size
  
  \ceq{\hfill n}
  {\le}
  {c\,\frac{k}{\epsilon^2}\log\frac{k}{\epsilon^2}}

  If we set $\epsilon=1/\tau^*$, then $\range(s)$ is a transversal and we obtain the required bound.
\end{proof}

The bound in the proposition above can be improved.
One can replace $(\tau^*)^2$ with  $\tau^*$ at the cost of a more difficult proof.

\section{Helly-type properties}

We now investigate methods of bounding $\tau^*=\nu^*$.
As motivation we cite a classical theorem of Helly.

\begin{proposition}[(Helly Theorem)]
Let $\Phi$ be a finite family of convex sets in $\RR^d$.
Assume that any $d+1$ sets from $\Phi$ have non-empty intersection.
Then the whole family $\Phi$ has non-empty intersection.\QED
\end{proposition}

Note that Helly's theorem does not hold for families of finite \vc-dimension.
A counter example of \vc-dimension $2$ can be constructed with a family containing sets that are unions of two finite intervals of the real line.

We will deal with the following property, which is more robust. It says that if there is \textit{plenty\/} of \textit{small\/} collections of sets with nonempty intersection, then there is a \textit{large\/} collection with nonempty intersection.

\begin{definition}
We say that $\phi(x\,;z)$ \emph{has fractional Helly number $k$\/} if for all $\alpha>0$ there is a $\beta>0$ such that  for every finite $A\subseteq\U$ and $B\subseteq\V$ the following holds (write $n$ for $|B|$):

\ceq{(1)\hfill \bigcap_{b\in B'}\phi(A,b)}{\neq}{\0}\hfill for at least \ $\displaystyle\alpha{n\choose k}$ \ sets \ $\displaystyle B'\in{B\choose k}$

then

\ceq{(2)\hfill\bigcap_{b\in B''}\phi(A,b)}{\neq}{\0}\hfill for some $B''\subseteq B$ of cardinality $\ge\beta\,n$.

We say that $\phi$ has the \emph{fractional Helly property\/} if it has some finite Helly number.
The \emph{fractional Helly number\/} of $\phi(x\,;z)$ is the smallest number $k$ satisfying the property above.\QED
\end{definition}

For further reference, we note that (2) in the definition above can be rewritten as 

\ceq{(2$'$)\hfill\big|\phi(a,B)\big|}{\geq}{\beta\,n}\hfill for some $a\in A$.

The following is proves that \nip{} formulas have the fractionally Helly property (in a strong sense).

\begin{theorem}[(Matou\v{s}ek)]\label{thm_matousek}
Let  $\phi(x\,;z)$ have \vc-codimension $<k$.
Then $\phi(x\,;z)$ has fractional Helly number $k$.
Moreover, $\beta$ in the definition above only depends on $\alpha$ and $k$.
\end{theorem}

\begin{proof}
Let $\alpha$ be arbitrary and set $\beta=1/2m$ where $m$ is such that 

\ceq{\hfill \bigsum^{k-1}_{i=0} \binom{n}{i}}{<}{\frac\alpha4{m\choose k}.}

Note that, by the Sauer-Shelah Lemma~\ref{lem_sauer}, the r.h.s.\@ is strictly larger than $\pi^*_\phi(m)$ for all $\phi(x\,;z)$ with \vc-codimension $<k$.

Assume for a contradiction that some finite $A\subseteq\U$ and $B\subseteq\V$ contradicts the definition above.
That is,
 
\ceq{(1)\hfill \bigcap_{b\in B'}\phi(A,b)}{\neq}{\0}\hfill for at least \ $\displaystyle\alpha{n\choose k}$ \ sets \ $\displaystyle B'\in{B\choose k}$

and

\ceq{(2)\hfill\big|\phi(a\,;B)\big|}{<}{\beta\,n}\hfill for all $a\in A$.

Note that we can assume that $n>2m$ otherwise $\beta\,n<1$ and (2) never occur.
We will find a set $B''\subseteq B$ of cardinality $m$ with more than $\pi^*(m)$ distinct $\phi(x\,;z)^*$-definable subsets, a contradiction.

Let $P$ be the set of pairs $B'\subseteq B''\subseteq B$ such that $|B'|=k$ and $|B''|=m$.
We say that a pair $B'\subseteq B''$ in $P$ is \textit{good\/} if there is $a\in A$ such that $B'=\phi(a,B'')$.
That is, $B'$ is a $\phi(x\,;z)^*$-definable subset of $B''$.

Claim 1. 
Assume the uniform probability on $P$.
Then the probability that a random pair is good is $\ge\alpha/4$.

Assume Claim~1 for now and continue with the proof.
We can think that the random pair in $P$ is chosen by first picking $B''\in{B\choose m}$ with the uniform distribution and than $B'\in{B''\choose k\phantom{'}}$ again with the uniform distribution. 
(To put it more pedantically, we are applying the theorem of total probability.)
If the the probability that a pair is good is $\ge\alpha/4$, then for at least one $B''\in{B\choose m}$ the probability of finding a good subset $B'$ is $\ge\alpha/4$.
Therefore, $B''$ has $\ge\frac\alpha4{m\choose k}>\pi^*(m)$ good subsets.
A contradiction which proves the theorem given the claim.

We now prove the claim.
There is another equivalent way to pick a random pair in $P$.
First we choose at random $B'\subseteq B$ of cardinality $k$ then obtain $B''$ by adding $m-k$ random elements from $B\sm B'$.
By (1), the probability that $B'$ is such that $\bigcap_{b\in B'}\phi(A,b)\neq\0$ is at least $\alpha$.
So, assume that $B'$ is such, and fix any $a$ is this intersection.
By (2), there are $|\phi(a,B)|<\beta n$.
Then the probability that all $b\in B''\sm B'$ are such that $\neg\phi(a,b)$ is at least\smallskip

\ceq{\hfill{n-\beta n\choose m-k}\bigg/{n-k\choose m-k}}
{=}
{\prod^{m-k-1}_{i=0}\frac{n-\beta n-i}{n-k-i}}
\hfill we write $\beta n$ for $\lfloor \beta n \rfloor$

\ceq{}
{\ge}
{\prod^{m-k-1}_{i=0}\frac{n-\beta n-m}{n-m}}

\ceq{}
{\ge}
{\bigg(\frac{n-\beta n-m}{n-m}\bigg)^m}

\ceq{}
{=}
{\bigg(1-\frac{\beta n}{n-m}\bigg)^m}

\ceq{}
{\ge}
{\displaystyle(1-2\beta)^m\vphantom{\bigg)}}
\hfill because $n>2m$

\ceq{}
{\ge}
{\bigg(1-\frac{1}{m}\bigg)^m}
\hfill because $\beta\le1/2m.$

As we can assume $m\ge 2$, the probability that a random pair in $P$ is good is at least $\alpha/4$.
This proves Claim~1 and with it the theorem.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The (p,q)-theorem}

For integers $p\ge q$ we say that $\phi(x\,;z)$ has the \emph{$(p,q)$-property\/} if for every finite $A\subseteq\U$ and every $B\subseteq\V$ of cardinality $p$ there is some $B'\subseteq B$ of cardinality $q$ such that

\ceq{\hfill \bigcap_{b\in B'}\phi(A\,;b)}
{\neq}
{\0}

For ease of speaking we call $\phi(A\,;b)_{b\in B}$ a $p$-collection of definable subsets of $A$.
Note that, strictly speaking, these is not collection of sets but collection of parameters defining sets (though not intrinsically relevant, it is convenient not to assume extensionality). 

Hence, we can rephrase the $(p,q)$-property in plain English: out of any $p$-collection of definable sets there are at least $q$ sets with nonempty intersection.

For {\nip} formulas the $(p,q)$-property has this interesting consequence.
Namely, there is a bound to the cardinality of the transversal number $\tau$ that only depends on $p,q$ and the \vc-dimension of the formula. Alon and Kleitman proved it for collections of convex sets of the euclidean space, later Matou\v{s}ek adapted the proof to collections of finite \vc-dimension (formally, the two results do not imply each other).

\begin{theorem}[(Alon, Kleitman + Matou\v{s}ek)]
  Let $p\ge q> k$ be natural numbers.
  There is a number $N=N(k,p,q)$ such that 
  $\tau_{\phi(A\,;B)}\le N$ for all formulas $\phi(x\,;z)$ with the $(p,q)$-property and \vc-codimension $\le k$, and every $A\subseteq\U$ and $B\subseteq\V$.
\end{theorem}

\begin{proof}
As we are not trying to optimize $N$, we may prove the theorem for $q=k+1$.
By Proposition~\ref{prop_bound_fractional_trans}, the transversal number is bounded by a function of $\tau^*$, so it is enough to bound $\tau^*$. By Proposition~\ref{thm_fractional_nu=tau}, we can equivalently bound the fractional packing number $\nu^*$ because it coincides with $\tau^*$.

Let $B'\subseteq B$ be an optimal fractional packing.  That is, $\nu^*=|B'|$ where $B'\le\Indicator_B$ is such that $|\phi(a,B')|\le1$ for every $a\in A$. As we rather work with regular sets than with fractional multisets, we apply a trick that allows to replace $B'$ with a regular set $C'$. 

By Theorem~\ref{thm_fractional_nu=tau} we may assume that $B'$ is rational valued. Therefore $B'=(1/m)\,C$ where $m$ is a positive integer and $C$ is a integral valued multiset over $\V$.
Replace $\V$ with $\V\times[m]$.
Define $\phi\!_{_\times}\!(a\,;b,i)$ to be the relation that holds if and only if $\phi(a\,;b)$ holds.
Then we can replace the multiset $C$ with a regular set $C'\subseteq\V\times[m]$ such that $|\phi\!_{_\times}\!(a\,;C')|\le m$ for every $a\in A$.

If write $n$ for $|C'|$, then $\nu^*=n/m$.

\smallskip
Claim~1. $\phi\!_{_\times}\!(x\,;z,y)$ satisfies the $(qp,q)$-property.

Let $D\subseteq\V\times[m]$ have cardinality $qp$. 
If the $qp$-collection $\phi\!_{_\times}\!(A\,;b,i)_{b,i\in D}$ contains $q$ copies of the same definable set $\phi(A\,;b)$, then we immediately have the required $q$-collection with nonempty intersection.
So, suppose not.
Then  $\phi\!_{_\times}\!(A\,;b,i)_{b,i\in D}$ contains $p$ distinct sets $\phi(A,b_1),\dots,\phi(A,b_p)$. 
Then the $q$-collection with nonempty intersection is obtained from the $(p,q)$-property of $\phi(x\,;z)$.

\smallskip
Claim 2.
There is an $\alpha=\alpha(p,q)>0$ such that

\ceq{\hfill \bigcap_{b,i\in D}\phi\!_{_\times}\!(A\,;b,i)}{\neq}{\0}\hfill for at least \ $\displaystyle\alpha{n\choose q}$ \ sets \ $\displaystyle D\in{C'\choose q}$.

By Claim~1, every $qp$-collection of $\phi\!_{_\times}\!$-definable sets contains at least one $q$-collection with non-empty intersection.
Every $q$-collection is contained in ${n-q\choose qp-q}$ many $qp$-collections.
Therefore the number $q$-collections with non-empty intersection is

\ceq{\hfill{n\choose qp}\Big/{n-q\choose qp-q}}{=}{{n\choose q}\Big/{qp\choose q}.}

Therefore, the claim holds with $\displaystyle1/\alpha={qp\choose q}$.

Now we can resume the proof of the theorem (recall that our goal is to bound $\nu^*$ by a function of $p,q$, and $k$).
Let $\beta=\beta(\alpha,k)$ be as in Theorem~\ref{thm_matousek}.
As $\phi\!_{_\times}\!(x\,;z,y)$ has the same \vc-codimension as $\phi(x\,;z)$, by Claim~2 there is an $a\in A$ such that $\phi(a,C')$ has cardinality at least $\beta\,n$. So, from $\beta\,n\le |\phi(a,C')|\le m$ we obtain $\nu^*\le 1/\beta$.
\end{proof}

\end{document}
